Parameters:
  vpcidr:
    Type: String
    Minlength: 9
    Maxlength: 18
    AllowedPattern: "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    ConstrainDescription: Use a valid range in the form x.x.x.x/16
    Default: 10.20.0.0/16
  publicSNcidrA:
    Type: String
    MinLength: 9
    MaxLength: 18
    AllowedPattern: "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    ConstraintDescription: Use a valid CIDR range in the form x.x.x.x/24
    Default: 10.20.0.0/24
  publicSNcidrB:
    Type: String
    MinLength: 9
    MaxLength: 18
    AllowedPattern: "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    ConstraintDescription: Must be a valid CIDR range in the form x.x.x.x/24
    Default: 10.20.3.0/24
  privateSNcidrA:
    Type: String
    Minlength: 9
    Maxlength: 18
    AllowedPattern: "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    ConstraintDescription: Use a valid CIDR range in the form x.x.x.x/24
    Default: 10.20.2.0/24
  privateSNcidrB:
    Type: String
    Minlength: 9
    Maxlength: 18
    AllowedPattern: "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    ConstraintDescription: Use a valid CIDR range in the form x.x.x.x/24
    Default: 10.20.4.0/24
Resources:
  VPC:
    Type: "AWS::EC2::VPC"
    Properties:
      CidrBlock: !Ref vpcidr
  IGW:
    Type: "AWS::EC2::InternateGateway"
  GatewayAttach:
    Type: "AWS::VPC::VPCGateWayAttachment"
    Properties:
      VpcId: !Ref VPC
      InternetGateWayId: !Ref IGW
  PublicSharedSubnetA:
    Type: "AWS::EC2::Subnet"
    Properties:
      AvailabilityZone: !Select [0, !GetAZs ]
      CidrBlock: !Ref publicSNcidrA
      MapPublicIpOnLaunch: true
      VpcId: !Ref VPC
  PublicSharedSubnetB:
    Type: "AWS::EC2::Subnet"
    Properties:
      AvailabilityZone: !Select [1, !GetAZs ]
      CidrBlock: !Ref publicSNcidrB
      MapPublicIpOnLaunch: true
      VpcId: !Ref VPC
  RTAsociationPSubnetA:
    Type: "AWS::EC2::SubnetRouteTableAssociation"
    Properties:
      RouteTableId: !Ref RouteTablePublic
      SubnetId: !Ref PublicSharedSubnetA
  RTAsociationPSubnetB:
    Type: "AWS::EC2::SubnetRouteTableAssociation"
    Properties:
      RouteTableId: !Ref RouteTablePublic
      SubnetId: !Ref PublicSharedSubnetB
  RouteDefaultPublic:
    Type: "AWS::EC2::Route"
    DependsOn: GatewayAttach
    Properties:
      Destination: 0.0.0.0/0
      GatewayId: IGW
      RouteTableId: !Ref RouteTablePublic
  RouteTablePublic:
    Type: "AWS::EC2::RouteTable"
    Properties:
      VpcId: !Ref VPC
  PrivatToPublicACL:
    Type: "AWS::EC2::NetworkAcl"
    Properties: 
      VpcId: !Ref VPC
Outputs: